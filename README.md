# CLUBE ZN - Instruções de Execução e Deploy

Este projeto utiliza o Supabase como backend e está configurado para ser publicado na [Vercel](https://vercel.com).

## ❗️ Ação Necessária: Configurar Supabase

A aplicação não funcionará sem as suas credenciais e a configuração correta do banco de dados. Por favor, siga estes passos primeiro.

### 1. Obtenha suas Credenciais Supabase

1.  **Acesse seu projeto Supabase:** Vá para [app.supabase.com](https://app.supabase.com), selecione seu projeto e navegue até **Project Settings > API**.
2.  **Copie suas credenciais:** Você precisará de dois valores:
    *   **Project URL**
    *   **Project API Keys > `anon` `public` key**

### 2. Crie a Tabela de Cupons

O sistema de cupons precisa de uma nova tabela no seu banco de dados Supabase.

1.  No painel do seu projeto Supabase, vá para **SQL Editor**.
2.  Clique em **New query**.
3.  Copie e cole todo o script SQL abaixo e clique em **RUN**.

```sql
-- Cria a tabela de cupons
CREATE TABLE public.coupons (
  id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  user_id uuid NOT NULL,
  offer_id bigint NOT NULL,
  code text NOT NULL,
  status text NOT NULL DEFAULT 'pending'::text,
  expires_at timestamp with time zone NOT NULL,
  CONSTRAINT coupons_pkey PRIMARY KEY (id),
  CONSTRAINT coupons_code_key UNIQUE (code),
  CONSTRAINT coupons_offer_id_fkey FOREIGN KEY (offer_id) REFERENCES offers (id) ON DELETE CASCADE,
  CONSTRAINT coupons_user_id_fkey FOREIGN KEY (user_id) REFERENCES profiles (id) ON DELETE CASCADE,
  CONSTRAINT coupons_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'used'::text, 'expired'::text])))
);

-- Adiciona comentários para clareza
COMMENT ON TABLE public.coupons IS 'Armazena os cupons de desconto gerados para usuários e ofertas.';

-- Habilita Row Level Security (RLS) para segurança
ALTER TABLE public.coupons ENABLE ROW LEVEL SECURITY;

-- Cria políticas de acesso (Policies)
-- Política: Usuários autenticados podem ver seus próprios cupons.
CREATE POLICY "Users can view their own coupons."
ON public.coupons
FOR SELECT USING (auth.uid() = user_id);

-- Política: Usuários autenticados podem criar cupons para si mesmos.
CREATE POLICY "Users can create coupons for themselves."
ON public.coupons
FOR INSERT WITH CHECK (auth.uid() = user_id);

-- NOTA: Nenhuma política de UPDATE é criada de propósito.
-- A atualização (validação) de cupons é controlada pela nossa API segura,
-- impedindo que usuários modifiquem cupons diretamente.

-- Cria índices para otimizar a performance das buscas
CREATE INDEX idx_coupons_user_id_offer_id ON public.coupons USING btree (user_id, offer_id);
CREATE INDEX idx_coupons_code ON public.coupons USING btree (code);
```

### 3. Configure o Frontend

Abra o arquivo `lib/supabaseClient.ts` e substitua os placeholders com suas credenciais **públicas**:

```typescript
// Em: lib/supabaseClient.ts

// ...

// TODO: Substitua pelos dados do seu projeto Supabase.
const supabaseUrl = 'https://<SEU-ID-DE-PROJETO>.supabase.co'; // Cole sua Project URL aqui
const supabaseKey = '<SUA-CHAVE-ANON>'; // Cole sua anon public key aqui

// ...
```

---

## Deploy na Vercel

Depois de configurar o Supabase, você está pronto para fazer o deploy.

1.  **Conecte seu repositório Git** (GitHub, GitLab, etc.) à Vercel.
2.  **Importe o projeto** na Vercel.
3.  **Configure as Variáveis de Ambiente:** Durante a importação, ou indo em **Settings > Environment Variables**, adicione as seguintes variáveis. Elas são essenciais para que o backend serverless possa se conectar ao Supabase de forma segura.

    *   `SUPABASE_URL`: Cole sua **Project URL** aqui.
    *   `SUPABASE_ANON_KEY`: Cole sua **`anon` `public` key** aqui.

4.  **Clique em Deploy.** A Vercel irá construir e publicar sua aplicação.

## Como a Aplicação Funciona Agora

*   **Frontend:** Uma aplicação React que roda no navegador do usuário.
*   **Backend:** A lógica de geração e validação de cupons agora vive em `Serverless Functions` na pasta `/api`. Elas são executadas pela Vercel sob demanda, de forma segura e escalável, usando as variáveis de ambiente que você configurou. Não há mais um servidor local para iniciar.
